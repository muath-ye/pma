{"version":3,"file":"database/query_generator.js","mappings":";;;;;;;;;;AAAuB;AAC4D;AACnF;AACA;AACA;AACA;AACA;AACA;AACA,SAASG,cAAcA,CAAA,EAAG;EACtB,OAAO;IACH,GAAG,EAAE,WAAW;IAChB,GAAG,EAAE,WAAW;IAChB,IAAI,EAAE,YAAY;IAClB,GAAG,EAAE,WAAW;IAChB,IAAI,EAAE,YAAY;IAClB,IAAI,EAAE,YAAY;IAClB,MAAM,EAAE,cAAc;IACtB,YAAY,EAAE,kBAAkB;IAChC,UAAU,EAAE,kBAAkB;IAC9B,gBAAgB,EAAE,sBAAsB;IACxC,SAAS,EAAE,iBAAiB;IAC5B,aAAa,EAAE,qBAAqB;IACpC,SAAS,EAAE,iBAAiB;IAC5B,aAAa,EAAE,qBAAqB;IACpC,QAAQ,EAAE,gBAAgB;IAC1B,cAAc,EAAE,kBAAkB;IAClC,YAAY,EAAE;EAClB,CAAC;AACL;AACA,SAASC,iBAAiBA,CAACC,WAAW,EAAEC,KAAK,EAAE;EAC3C,MAAMC,SAAS,GAAGD,KAAK,CAACE,GAAG,CAAC,CAAC;EAC7B,MAAMC,UAAU,GAAGH,KAAK,CAACI,QAAQ,CAAC,cAAc,CAAC,CAACF,GAAG,CAAC,CAAC;EACvD,IAAIG,KAAK,GAAG,GAAG,GAAGV,4EAAc,CAACQ,UAAU,KAAK,EAAE,GAAGF,SAAS,GAAGE,UAAU,CAAC,GAAG,IAAI;EACnFE,KAAK,IAAI,GAAG,GAAGV,4EAAc,CAACK,KAAK,CAACI,QAAQ,CAAC,mBAAmB,CAAC,CAACE,KAAK,CAAC,CAAC,CAACJ,GAAG,CAAC,CAAC,CAAC,GAAG,GAAG;EACtF,IAAIH,WAAW,CAACQ,IAAI,CAAC,eAAe,CAAC,CAACD,KAAK,CAAC,CAAC,CAACJ,GAAG,CAAC,CAAC,KAAK,MAAM,EAAE;IAC5D,IAAIM,WAAW,GAAGX,cAAc,CAAC,CAAC;IAClCQ,KAAK,IAAII,MAAM,CAACC,OAAO,CAACF,WAAW,CAACT,WAAW,CAACQ,IAAI,CAAC,cAAc,CAAC,CAACD,KAAK,CAAC,CAAC,CAACJ,GAAG,CAAC,CAAC,CAAC,EAAEN,+EAAiB,CAACG,WAAW,CAACQ,IAAI,CAAC,eAAe,CAAC,CAACD,KAAK,CAAC,CAAC,CAACJ,GAAG,CAAC,CAAC,CAAC,CAAC;EAC5J,CAAC,MACI;IACDG,KAAK,IAAI,GAAG,GAAGN,WAAW,CAACQ,IAAI,CAAC,cAAc,CAAC,CAACD,KAAK,CAAC,CAAC,CAACJ,GAAG,CAAC,CAAC;IAC7DG,KAAK,IAAI,IAAI,GAAGV,4EAAc,CAACI,WAAW,CAACQ,IAAI,CAAC,kBAAkB,CAAC,CAACD,KAAK,CAAC,CAAC,CAACJ,GAAG,CAAC,CAAC,CAAC,GAAG,IAAI;IACzFG,KAAK,IAAI,GAAG,GAAGV,4EAAc,CAACI,WAAW,CAACQ,IAAI,CAAC,mBAAmB,CAAC,CAACD,KAAK,CAAC,CAAC,CAACJ,GAAG,CAAC,CAAC,CAAC,GAAG,GAAG;EAC5F;EACA,OAAOG,KAAK;AAChB;AACA,SAASM,kBAAkBA,CAAA,EAAG;EAC1B,IAAIC,KAAK,GAAG,CAAC;EACb,IAAIP,KAAK,GAAG,EAAE;EACdX,6CAAC,CAAC,kBAAkB,CAAC,CAACmB,IAAI,CAAC,YAAY;IACnC,IAAId,WAAW,GAAGL,6CAAC,CAAC,IAAI,CAAC,CAACU,QAAQ,CAAC,oBAAoB,CAAC,CAACE,KAAK,CAAC,CAAC;IAChE,IAAIQ,WAAW,GAAGpB,6CAAC,CAAC,IAAI,CAAC,CAACU,QAAQ,CAAC,eAAe,CAAC,CAACE,KAAK,CAAC,CAAC;IAC3D,IAAIZ,6CAAC,CAAC,IAAI,CAAC,CAACQ,GAAG,CAAC,CAAC,KAAK,EAAE,IAAIY,WAAW,CAACC,IAAI,CAAC,SAAS,CAAC,EAAE;MACrD,IAAIH,KAAK,GAAG,CAAC,EAAE;QACXb,WAAW,CAACQ,IAAI,CAAC,kBAAkB,CAAC,CAACM,IAAI,CAAC,YAAY;UAClD,IAAInB,6CAAC,CAAC,IAAI,CAAC,CAACqB,IAAI,CAAC,SAAS,CAAC,EAAE;YACzBV,KAAK,IAAI,GAAG,GAAGX,6CAAC,CAAC,IAAI,CAAC,CAACQ,GAAG,CAAC,CAAC,GAAG,GAAG;UACtC;QACJ,CAAC,CAAC;MACN;MACAG,KAAK,IAAIP,iBAAiB,CAACC,WAAW,EAAEL,6CAAC,CAAC,IAAI,CAAC,CAAC;MAChDkB,KAAK,EAAE;IACX;EACJ,CAAC,CAAC;EACF,OAAOP,KAAK;AAChB;AACA,SAASW,YAAYA,CAACC,QAAQ,EAAEC,YAAY,EAAEC,EAAE,EAAE;EAC9C,IAAId,KAAK,GAAG,EAAE;EACdA,KAAK,IAAI,iBAAiB,GAAG,GAAG,GAAGV,4EAAc,CAACsB,QAAQ,CAAC,GAAG,GAAG;EACjE,IAAIC,YAAY,CAACC,EAAE,CAACC,UAAU,CAAC,CAAC,CAAC,CAAC,KAAK,EAAE,EAAE;IACvCf,KAAK,IAAI,OAAO,GAAGV,4EAAc,CAACuB,YAAY,CAACD,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,GAAG;IAClEZ,KAAK,IAAI,OAAO,GAAGV,4EAAc,CAACuB,YAAY,CAACC,EAAE,CAACC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,GAAG;EAC3E,CAAC,MACI;IACDf,KAAK,IAAI,OAAO,GAAGV,4EAAc,CAACwB,EAAE,CAACC,UAAU,CAAC,GAAG,GAAG;EAC1D;EACAf,KAAK,IAAI,IAAI,GAAGc,EAAE,CAACE,WAAW,GAAG,GAAG;EACpC,IAAIH,YAAY,CAACC,EAAE,CAACG,qBAAqB,CAAC,CAAC,CAAC,CAAC,KAAK,EAAE,EAAE;IAClDjB,KAAK,IAAI,MAAM,GAAGV,4EAAc,CAACuB,YAAY,CAACC,EAAE,CAACG,qBAAqB,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,GAAG;EACrF,CAAC,MACI;IACDjB,KAAK,IAAI,MAAM,GAAGV,4EAAc,CAACwB,EAAE,CAACG,qBAAqB,CAAC,GAAG,GAAG;EACpE;EACAjB,KAAK,IAAI,IAAI,GAAGc,EAAE,CAACI,sBAAsB,GAAG,GAAG;EAC/C,OAAOlB,KAAK;AAChB;AACA,SAASmB,cAAcA,CAACxB,KAAK,EAAEmB,EAAE,EAAEM,UAAU,EAAE;EAC3C,IAAIC,YAAY,GAAGP,EAAE,CAACC,UAAU,KAAKpB,KAAK,IAAIyB,UAAU,CAACE,QAAQ,CAACR,EAAE,CAACG,qBAAqB,CAAC;EAC3F,IAAIM,cAAc,GAAGT,EAAE,CAACG,qBAAqB,KAAKtB,KAAK,IAAIyB,UAAU,CAACE,QAAQ,CAACR,EAAE,CAACC,UAAU,CAAC;EAC7F,OAAOM,YAAY,IAAIE,cAAc;AACzC;AACA,SAASC,YAAYA,CAAC7B,KAAK,EAAEkB,YAAY,EAAEO,UAAU,EAAEK,WAAW,EAAE;EAChE,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGD,WAAW,CAACE,MAAM,EAAED,CAAC,EAAE,EAAE;IACzC,IAAIZ,EAAE,GAAGW,WAAW,CAACC,CAAC,CAAC;IACvB,IAAIP,cAAc,CAACxB,KAAK,EAAEmB,EAAE,EAAEM,UAAU,CAAC,EAAE;MACvC,OAAOT,YAAY,CAAChB,KAAK,EAAEkB,YAAY,EAAEC,EAAE,CAAC;IAChD;EACJ;EACA,OAAO,EAAE;AACb;AACA,SAASc,WAAWA,CAACjC,KAAK,EAAEkB,YAAY,EAAEO,UAAU,EAAEK,WAAW,EAAE;EAC/D,IAAIzB,KAAK,GAAGwB,YAAY,CAAC7B,KAAK,EAAEkB,YAAY,EAAEO,UAAU,EAAEK,WAAW,CAAC;EACtE,IAAIzB,KAAK,KAAK,EAAE,EAAE;IACd,IAAIoB,UAAU,CAACO,MAAM,GAAG,CAAC,EAAE;MACvB3B,KAAK,IAAI,QAAQ;IACrB;IACAA,KAAK,IAAI,GAAG,GAAGV,4EAAc,CAACK,KAAK,CAAC,GAAG,GAAG;IAC1C,IAAIkB,YAAY,CAAClB,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,EAAE,EAAE;MAC/BK,KAAK,IAAI,OAAO,GAAGV,4EAAc,CAACuB,YAAY,CAAClB,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,GAAG;IACnE;EACJ;EACAyB,UAAU,CAACS,IAAI,CAAClC,KAAK,CAAC;EACtB,OAAOK,KAAK;AAChB;AACA,SAAS8B,iBAAiBA,CAACjB,YAAY,EAAEY,WAAW,EAAE;EAClD,IAAIL,UAAU,GAAG,EAAE;EACnB,IAAIpB,KAAK,GAAG,EAAE;EACd,KAAK,IAAIL,KAAK,IAAIkB,YAAY,EAAE;IAC5B,IAAIA,YAAY,CAACkB,cAAc,CAACpC,KAAK,CAAC,EAAE;MACpCK,KAAK,IAAI4B,WAAW,CAACjC,KAAK,EAAEkB,YAAY,EAAEO,UAAU,EAAEK,WAAW,CAAC;IACtE;EACJ;EACA,OAAOzB,KAAK;AAChB;AACAI,MAAM,CAACE,kBAAkB,GAAGA,kBAAkB;AAC9CF,MAAM,CAAC0B,iBAAiB,GAAGA,iBAAiB;;;;;;;AC5H5C","sources":["webpack://phpmyadmin/./resources/js/src/database/query_generator.ts","webpack://phpmyadmin/external var \"jQuery\""],"sourcesContent":["import $ from 'jquery';\nimport { escapeBacktick, escapeSingleQuote } from '../modules/functions/escape.ts';\n/**\n * @fileoverview    function used in QBE for DB\n * @name            Database Operations\n *\n * @requires    jQueryUI\n */\nfunction getFormatsText() {\n    return {\n        '=': ' = \\'%s\\'',\n        '>': ' > \\'%s\\'',\n        '>=': ' >= \\'%s\\'',\n        '<': ' < \\'%s\\'',\n        '<=': ' <= \\'%s\\'',\n        '!=': ' != \\'%s\\'',\n        'LIKE': ' LIKE \\'%s\\'',\n        'LIKE %...%': ' LIKE \\'%%%s%%\\'',\n        'NOT LIKE': ' NOT LIKE \\'%s\\'',\n        'NOT LIKE %...%': ' NOT LIKE \\'%%%s%%\\'',\n        'BETWEEN': ' BETWEEN \\'%s\\'',\n        'NOT BETWEEN': ' NOT BETWEEN \\'%s\\'',\n        'IS NULL': ' \\'%s\\' IS NULL',\n        'IS NOT NULL': ' \\'%s\\' IS NOT NULL',\n        'REGEXP': ' REGEXP \\'%s\\'',\n        'REGEXP ^...$': ' REGEXP \\'^%s$\\'',\n        'NOT REGEXP': ' NOT REGEXP \\'%s\\''\n    };\n}\nfunction generateCondition(criteriaDiv, table) {\n    const tableName = table.val();\n    const tableAlias = table.siblings('.table_alias').val();\n    var query = '`' + escapeBacktick(tableAlias === '' ? tableName : tableAlias) + '`.';\n    query += '`' + escapeBacktick(table.siblings('.columnNameSelect').first().val()) + '`';\n    if (criteriaDiv.find('.criteria_rhs').first().val() === 'text') {\n        var formatsText = getFormatsText();\n        query += window.sprintf(formatsText[criteriaDiv.find('.criteria_op').first().val()], escapeSingleQuote(criteriaDiv.find('.rhs_text_val').first().val()));\n    }\n    else {\n        query += ' ' + criteriaDiv.find('.criteria_op').first().val();\n        query += ' `' + escapeBacktick(criteriaDiv.find('.tableNameSelect').first().val()) + '`.';\n        query += '`' + escapeBacktick(criteriaDiv.find('.columnNameSelect').first().val()) + '`';\n    }\n    return query;\n}\nfunction generateWhereBlock() {\n    var count = 0;\n    var query = '';\n    $('.tableNameSelect').each(function () {\n        var criteriaDiv = $(this).siblings('.jsCriteriaOptions').first();\n        var useCriteria = $(this).siblings('.criteria_col').first();\n        if ($(this).val() !== '' && useCriteria.prop('checked')) {\n            if (count > 0) {\n                criteriaDiv.find('input.logical_op').each(function () {\n                    if ($(this).prop('checked')) {\n                        query += ' ' + $(this).val() + ' ';\n                    }\n                });\n            }\n            query += generateCondition(criteriaDiv, $(this));\n            count++;\n        }\n    });\n    return query;\n}\nfunction generateJoin(newTable, tableAliases, fk) {\n    var query = '';\n    query += ' \\n\\tLEFT JOIN ' + '`' + escapeBacktick(newTable) + '`';\n    if (tableAliases[fk.TABLE_NAME][0] !== '') {\n        query += ' AS `' + escapeBacktick(tableAliases[newTable][0]) + '`';\n        query += ' ON `' + escapeBacktick(tableAliases[fk.TABLE_NAME][0]) + '`';\n    }\n    else {\n        query += ' ON `' + escapeBacktick(fk.TABLE_NAME) + '`';\n    }\n    query += '.`' + fk.COLUMN_NAME + '`';\n    if (tableAliases[fk.REFERENCED_TABLE_NAME][0] !== '') {\n        query += ' = `' + escapeBacktick(tableAliases[fk.REFERENCED_TABLE_NAME][0]) + '`';\n    }\n    else {\n        query += ' = `' + escapeBacktick(fk.REFERENCED_TABLE_NAME) + '`';\n    }\n    query += '.`' + fk.REFERENCED_COLUMN_NAME + '`';\n    return query;\n}\nfunction existReference(table, fk, usedTables) {\n    var isReferredBy = fk.TABLE_NAME === table && usedTables.includes(fk.REFERENCED_TABLE_NAME);\n    var isReferencedBy = fk.REFERENCED_TABLE_NAME === table && usedTables.includes(fk.TABLE_NAME);\n    return isReferredBy || isReferencedBy;\n}\nfunction tryJoinTable(table, tableAliases, usedTables, foreignKeys) {\n    for (var i = 0; i < foreignKeys.length; i++) {\n        var fk = foreignKeys[i];\n        if (existReference(table, fk, usedTables)) {\n            return generateJoin(table, tableAliases, fk);\n        }\n    }\n    return '';\n}\nfunction appendTable(table, tableAliases, usedTables, foreignKeys) {\n    var query = tryJoinTable(table, tableAliases, usedTables, foreignKeys);\n    if (query === '') {\n        if (usedTables.length > 0) {\n            query += '\\n\\t, ';\n        }\n        query += '`' + escapeBacktick(table) + '`';\n        if (tableAliases[table][0] !== '') {\n            query += ' AS `' + escapeBacktick(tableAliases[table][0]) + '`';\n        }\n    }\n    usedTables.push(table);\n    return query;\n}\nfunction generateFromBlock(tableAliases, foreignKeys) {\n    var usedTables = [];\n    var query = '';\n    for (var table in tableAliases) {\n        if (tableAliases.hasOwnProperty(table)) {\n            query += appendTable(table, tableAliases, usedTables, foreignKeys);\n        }\n    }\n    return query;\n}\nwindow.generateWhereBlock = generateWhereBlock;\nwindow.generateFromBlock = generateFromBlock;\n","module.exports = jQuery;"],"names":["$","escapeBacktick","escapeSingleQuote","getFormatsText","generateCondition","criteriaDiv","table","tableName","val","tableAlias","siblings","query","first","find","formatsText","window","sprintf","generateWhereBlock","count","each","useCriteria","prop","generateJoin","newTable","tableAliases","fk","TABLE_NAME","COLUMN_NAME","REFERENCED_TABLE_NAME","REFERENCED_COLUMN_NAME","existReference","usedTables","isReferredBy","includes","isReferencedBy","tryJoinTable","foreignKeys","i","length","appendTable","push","generateFromBlock","hasOwnProperty"],"sourceRoot":""}